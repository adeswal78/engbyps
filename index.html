<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RWA - Courses</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg-1: #0f1724;
      --card: #0b1220;
      --accent: #ff5858;
      --accent-2: #ffb347;
      --muted: #bfc8d6;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: Inter, "Segoe UI", Arial, sans-serif;
      background:
        radial-gradient(800px 400px at 10% 10%, rgba(255,180,71,0.07), transparent 8%),
        linear-gradient(180deg,#061022 0%, #0f1724 100%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
    }

    .app {
      max-width:1200px;
      margin:0 auto;
    }

    header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:20px;
    }
    .title {
      display:flex;
      gap:14px;
      align-items:center;
    }
    .logo {
      width:56px;height:56px;border-radius:12px;
      background: linear-gradient(135deg,var(--accent-2),var(--accent));
      display:flex;align-items:center;justify-content:center;font-weight:900;color:#102033;
      box-shadow: 0 6px 20px rgba(255,88,88,0.12);
      font-size:18px;
    }
    h1{
      margin:0;font-size:1.6rem;letter-spacing:0.4px;color:#fff;
    }
    .sub {
      color:var(--muted); font-size:0.95rem;
    }

    /* search area */
    .controls {
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .search {
      display:flex;
      gap:8px;
      background:var(--glass);
      padding:6px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 6px 24px rgba(2,6,23,0.35);
    }
    .search input{
      background:transparent;border:0;padding:10px 12px;color:#eaf2ff;outline:none;width:320px;
      font-size:0.98rem;
    }
    .btn {
      background: linear-gradient(90deg,var(--accent-2),var(--accent));
      color:#071025;padding:10px 14px;border-radius:10px;border:none;font-weight:800;
      cursor:pointer; box-shadow: 0 10px 30px rgba(255,88,88,0.12);
    }
    .btn.ghost {
      background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:700;
      padding:9px 12px;border-radius:10px; cursor:pointer;
    }

    /* grid */
    .grid {
      margin-top:20px;
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
    }

    /* card */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.03);
      transition: transform .18s ease, box-shadow .18s ease;
      display:flex;
      flex-direction:column;
      min-height:320px;
    }
    .card:hover{ transform: translateY(-8px); box-shadow: 0 18px 50px rgba(2,6,23,0.6); }

    .thumb {
      height:160px;
      width:100%;
      display:block;
      object-fit:cover;
      background:linear-gradient(90deg,#0b1230,#082033);
    }
    .card-body {
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1;
    }

    .row-1 {
      display:flex;align-items:flex-start;gap:10px;justify-content:space-between;
    }
    .title-line{
      display:flex;flex-direction:column;gap:6px;flex:1;
    }
    .course-name{
      margin:0;color:#fff;font-weight:800;font-size:1.02rem;line-height:1.15;
      letter-spacing:0.2px;
    }
    .exam-name{ font-size:0.88rem;color:var(--accent-2); font-weight:700; }

    .desc {
      font-size:0.9rem;color:var(--muted);line-height:1.3; max-height:3.9em; overflow:hidden;
      text-overflow: ellipsis;
    }

    .meta {
      display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:auto;
    }
    .left-meta { display:flex;gap:10px;align-items:center; }
    .date-box{
      background:rgba(255,255,255,0.03); padding:8px 10px;border-radius:10px;font-weight:700;
      display:flex;gap:8px;align-items:center;color:var(--muted);font-size:0.88rem;
    }
    .date-box .dot{ width:32px;height:32px;border-radius:8px;background:linear-gradient(90deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:900;color:#071025; }

    .right-meta { display:flex;align-items:center;gap:8px; }

    .price {
      background: linear-gradient(90deg,var(--accent-2),var(--accent));
      padding:8px 12px;border-radius:10px;color:#071025;font-weight:900; font-size:0.98rem;
    }
    .mrp { font-size:0.82rem;color:rgba(255,255,255,0.6); text-decoration:line-through; margin-left:8px; font-weight:700; }

    .cta {
      width:100%;
      text-align:center;
      margin-top:10px;
    }
    .open-btn {
      width:100%;
      padding:10px 12px;border-radius:10px;border:0;background:transparent;color:var(--accent-2);
      border:1px solid rgba(255,255,255,0.06); cursor:pointer;font-weight:800; transition:all .12s;
    }
    .open-btn:hover { background: rgba(255,255,255,0.03); color:#fff; transform:translateY(-3px); border-color:rgba(255,255,255,0.08); }

    .tag-top {
      position:relative;
      top:-44px; left:12px;
      display:inline-block;padding:6px 10px;background:rgba(0,0,0,0.5);color:#fff;border-radius:999px;font-weight:800;font-size:0.8rem;
      backdrop-filter: blur(6px);
    }

    .empty {
      text-align:center;color:var(--muted);padding:40px;border-radius:12px;background:var(--glass-2);
    }

    @media (max-width:760px){
      .search input{width:160px}
      .grid{grid-template-columns: repeat(auto-fill,minmax(200px,1fr))}
    }
  </style>
</head>
<body>
      <div class="controls" role="search">
        <div class="search" aria-label="Search courses">
          <svg style="width:18px;height:18px;opacity:0.8;margin-left:8px" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#dfe9ff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="#dfe9ff" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="searchInput" type="search" placeholder="Search by course or exam" aria-label="Search courses" />
        </div>
        <button id="clearBtn" class="btn ghost" title="Clear search">Clear</button>
        <button id="refreshBtn" class="btn" title="Refresh list">Refresh</button>
      </div>
    </header>

    <main>
      <section id="grid" class="grid" aria-live="polite"></section>
      <div id="empty" class="empty" style="display:none;margin-top:18px">No courses match your search.</div>
    </main>
  </div>

<script>
  // helper to get query param (not used for index but kept)
  function getQueryParam(name){ const u=new URL(window.location.href); return u.searchParams.get(name); }

  // strip HTML tags and limit text
  function stripHtml(html){
    if(!html) return '';
    const tmp = document.createElement('div');
    tmp.innerHTML = html;
    const text = tmp.textContent || tmp.innerText || '';
    return text.replace(/\s+/g,' ').trim();
  }
  function excerptText(text, n=140){
    if(!text) return '';
    if(text.length<=n) return text;
    return text.slice(0,n).trim() + '…';
  }

  // price resolver (from API fields)
  function resolvePrice(course){
    const p = course.price;
    const mrp = Number(course.mrp) || 0;
    const priceNum = Number(String(p).replace(/[^0-9.-]+/g,'')) || 0;
    if(priceNum > 0) return {label:`₹${priceNum}`, mrp: (mrp>0 && mrp>priceNum) ? `₹${mrp}` : ''};
    if(String(course.is_paid) === "1" || course.is_paid === 1) return {label:'Paid', mrp:''};
    // some courses in API use negative sentinel -3 for "paid" — treat negative as Paid
    if(Number(p) < 0) return {label:'Paid', mrp:''};
    return {label:'Free', mrp:''};
  }

  // format date display
  function prettyDate(d){
    if(!d) return '-';
    // try to parse 'YYYY-MM-DD' or with time
    const tryParse = (s) => {
      const t = new Date(s);
      if(!isNaN(t)) return t;
      // try replacing space with T or slicing first 10 chars
      const t2 = new Date(String(s).slice(0,10));
      if(!isNaN(t2)) return t2;
      return null;
    };
    const dt = tryParse(d);
    if(!dt) return d;
    return dt.toLocaleDateString('en-IN', { day:'numeric', month:'short', year:'numeric' });
  }

  // render list of cards
  function renderList(courses){
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    grid.innerHTML = '';
    const shown = courses.filter(c => String(c.enable) === "1");
    if(!shown.length){
      empty.style.display = 'block';
      return;
    } else empty.style.display = 'none';

    // sort: featured then start_date ascending
    shown.sort((a,b)=>{
      const fa = Number(a.is_featured||a.featured||0), fb = Number(b.is_featured||b.featured||0);
      if(fb - fa) return fb-fa;
      const da = new Date(a.start_date || a.startDate || a.start || 0).getTime() || 0;
      const db = new Date(b.start_date || b.startDate || b.start || 0).getTime() || 0;
      return da - db;
    });

    shown.forEach(course=>{
      const card = document.createElement('article');
      card.className = 'card';
      card.setAttribute('tabindex','0');
      card.setAttribute('aria-label', course.course_name || 'Course');

      // thumbnail
      const img = document.createElement('img');
      img.className = 'thumb';
      img.alt = course.course_name || 'thumbnail';
      img.src = course.course_thumbnail || 'https://i.postimg.cc/x1M0YN5Z/sunny.jpg';
      img.onerror = function(){ this.onerror=null; this.src='https://i.postimg.cc/x1M0YN5Z/sunny.jpg' };

      card.appendChild(img);

      const body = document.createElement('div');
      body.className = 'card-body';

      const row1 = document.createElement('div');
      row1.className = 'row-1';

      const left = document.createElement('div');
      left.className = 'title-line';

      const cname = document.createElement('h3');
      cname.className = 'course-name';
      cname.textContent = course.course_name || 'Untitled';

      const exam = document.createElement('div');
      exam.className = 'exam-name';
      exam.textContent = course.exam_name || '';

      left.appendChild(cname);
      left.appendChild(exam);
      row1.appendChild(left);

      // optional tag if featured/new
      if(String(course.is_featured||course.featured||0) === "1" || course.gif_display === "1"){
        const tag = document.createElement('div');
        tag.className = 'tag-top';
        tag.textContent = (String(course.is_featured||course.featured||0) === "1") ? 'FEATURED' : 'NEW';
        row1.appendChild(tag);
      }

      body.appendChild(row1);

      // description excerpt
      const raw = stripHtml(course.course_description || '');
      if(raw){
        const p = document.createElement('div');
        p.className = 'desc';
        p.textContent = excerptText(raw, 120);
        body.appendChild(p);
      }

      // meta row
      const meta = document.createElement('div');
      meta.className = 'meta';

      const leftMeta = document.createElement('div');
      leftMeta.className = 'left-meta';
      const dbox = document.createElement('div');
      dbox.className = 'date-box';
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.textContent = (course.start_date ? new Date(course.start_date).getDate() : '—');
      dbox.appendChild(dot);
      const dtext = document.createElement('div');
      dtext.textContent = prettyDate(course.start_date || course.startDate || '');
      dbox.appendChild(dtext);
      leftMeta.appendChild(dbox);

      meta.appendChild(leftMeta);

      // right: price
      const rightMeta = document.createElement('div');
      rightMeta.className = 'right-meta';
      const price = resolvePrice(course);
      const priceBox = document.createElement('div');
      priceBox.className = 'price';
      priceBox.textContent = price.label;
      rightMeta.appendChild(priceBox);
      if(price.mrp){
        const mrp = document.createElement('div');
        mrp.className = 'mrp';
        mrp.textContent = price.mrp;
        rightMeta.appendChild(mrp);
      }
      meta.appendChild(rightMeta);

      body.appendChild(meta);

      // CTA button
      const ctaWrap = document.createElement('div');
      ctaWrap.className = 'cta';
      const btn = document.createElement('button');
      btn.className = 'open-btn';
      btn.textContent = 'Open Content';
      btn.onclick = function(){
        // redirect to folder.html with courseId param (and parent_id -1)
        const q = encodeURIComponent(course.id || course.course_id || '');
        window.location.href = `folder.html?courseId=${q}&parent_id=-1`;
      };
      ctaWrap.appendChild(btn);
      body.appendChild(ctaWrap);

      card.appendChild(body);
      grid.appendChild(card);
    });
  }

  // fetch API and initialize
  let allCourses = [];
  async function load(){
    try{
      const res = await fetch('https://adeswal-eng.onrender.com/api/get/courselistnewv2');
      const json = await res.json();
      if(json && json.status === 200 && Array.isArray(json.data)){
        allCourses = json.data;
        renderList(allCourses);
      } else {
        document.getElementById('grid').innerHTML = `<div class="empty">No courses found.</div>`;
      }
    }catch(err){
      console.error(err);
      document.getElementById('grid').innerHTML = `<div class="empty">Failed to load courses.</div>`;
    }
  }

  // search/filter
  document.addEventListener('DOMContentLoaded', function(){
    const s = document.getElementById('searchInput');
    const clear = document.getElementById('clearBtn');
    const refresh = document.getElementById('refreshBtn');

    s.addEventListener('input', function(){
      const v = s.value.trim().toLowerCase();
      if(!v) return renderList(allCourses);
      const filtered = allCourses.filter(c=>{
        const name = (c.course_name||'').toLowerCase();
        const exam = (c.exam_name||'').toLowerCase();
        return name.includes(v) || exam.includes(v);
      });
      renderList(filtered);
    });

    clear.addEventListener('click', function(){ s.value=''; renderList(allCourses); });

    refresh.addEventListener('click', function(){ load(); });

    // initial load
    load();
  });
</script>
</body>
</html>
